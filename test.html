<html><head><title>C# Lexer</title><link rel='stylesheet' href='./style.css' type='text/css' /></head><body><pre> <span class="comment">// ==++==</span> </pre>
<pre> <span class="comment">// </span> </pre>
<pre> <span class="comment">//   Copyright (c) Microsoft Corporation.  All rights reserved.</span> </pre>
<pre> <span class="comment">// </span> </pre>
<pre> <span class="comment">// ==--==</span> </pre>
<pre><span class="comment"></span> <span class="comment">/*============================================================</span> </pre>
<pre><span class="comment"></span> <span class="comment">**</span> </pre>
<pre><span class="comment"></span> <span class="comment">** Class:  File</span> </pre>
<pre><span class="comment"></span> <span class="comment">** </span> </pre>
<pre><span class="comment"></span> <span class="comment">** <OWNER>Microsoft</OWNER></span> </pre>
<pre><span class="comment"></span> <span class="comment">**</span> </pre>
<pre><span class="comment"></span> <span class="comment">**</span> </pre>
<pre><span class="comment"></span> <span class="comment">** Purpose: A collection of methods for manipulating Files.</span> </pre>
<pre><span class="comment"></span> <span class="comment">**</span> </pre>
<pre><span class="comment"></span> <span class="comment">**        April 09,2000 (some design refactorization)</span> </pre>
<pre><span class="comment"></span> <span class="comment">**</span> </pre>
<pre><span class="comment"></span> <span class="comment">===========================================================*/</span> </pre>
<pre>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">Permissions</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">PermissionSet</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">PermissionSet</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">Win32Native</span>  <span class="operator">=</span>  <span class="identifier">Microsoft</span> <span class="operator">.</span> <span class="identifier">Win32</span> <span class="operator">.</span> <span class="identifier">Win32Native</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Runtime</span> <span class="operator">.</span> <span class="identifier">InteropServices</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_MACL</span> </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">AccessControl</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Text</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">Microsoft</span> <span class="operator">.</span> <span class="identifier">Win32</span> <span class="operator">.</span> <span class="identifier">SafeHandles</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Collections</span> <span class="operator">.</span> <span class="identifier">Generic</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Globalization</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Runtime</span> <span class="operator">.</span> <span class="identifier">Versioning</span> <span class="operator">;</span>  </pre>
<pre> <span class="keyword">using</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Diagnostics</span> <span class="operator">.</span> <span class="identifier">Contracts</span> <span class="operator">;</span>  </pre>
<pre>      </pre>
<pre> <span class="keyword">namespace</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">IO</span>  <span class="delimiter">{</span>      </pre>
<pre>     <span class="comment">// Class for creating FileStream objects, and some basic file management</span> </pre>
<pre>     <span class="comment">// routines such as Delete, etc.</span> </pre>
<pre>      <span class="delimiter">[</span> <span class="identifier">ComVisible</span> <span class="delimiter">(</span> <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>     <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="identifier">File</span> </pre>
<pre>      <span class="delimiter">{</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">int</span> <span class="identifier">GetFileExInfoStandard</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">StreamReader</span> <span class="identifier">OpenText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">StreamReader</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">StreamWriter</span> <span class="identifier">CreateText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span> <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">StreamWriter</span> <span class="identifier">AppendText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span> <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>         <span class="comment">// Copies an existing file to a new file. An exception is raised if the</span> </pre>
<pre>         <span class="comment">// destination file already exists. Use the </span> </pre>
<pre>         <span class="comment">// Copy(String, String, boolean) method to allow </span> </pre>
<pre>         <span class="comment">// overwriting an existing file.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// The caller must have certain FileIOPermissions.  The caller must have</span> </pre>
<pre>         <span class="comment">// Read permission to sourceFileName and Create</span> </pre>
<pre>         <span class="comment">// and Write permissions to destFileName.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Copy</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"destFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalCopy</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>      </pre>
<pre>         <span class="comment">// Copies an existing file to a new file. If overwrite is </span> </pre>
<pre>         <span class="comment">// false, then an IOException is thrown if the destination file </span> </pre>
<pre>         <span class="comment">// already exists.  If overwrite is true, the file is </span> </pre>
<pre>         <span class="comment">// overwritten.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// The caller must have certain FileIOPermissions.  The caller must have</span> </pre>
<pre>         <span class="comment">// Read permission to sourceFileName </span> </pre>
<pre>         <span class="comment">// and Write permissions to destFileName.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Copy</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">overwrite</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"destFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalCopy</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="identifier">overwrite</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">UnsafeCopy</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">overwrite</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"destFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalCopy</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="identifier">overwrite</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>         <span class="comment">/// <devdoc></span> </pre>
<pre>         <span class="comment">///    Note: This returns the fully qualified name of the destination file.</span> </pre>
<pre>         <span class="comment">/// </devdoc></span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="identifier">InternalCopy</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">overwrite</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">destFileName</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullSourceFileName</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullDestFileName</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">sourceState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">fullSourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">destState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">sourceState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">destState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullSourceFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>         </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">CopyFile</span> <span class="delimiter">(</span> <span class="identifier">fullSourceFileName</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="operator">,</span>   <span class="identifier">overwrite</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="comment">// Save Win32 error because subsequent checks will overwrite this HRESULT.</span> </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">String</span> <span class="identifier">fileName</span>  <span class="operator">=</span>  <span class="identifier">destFileName</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">errorCode</span>   <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_FILE_EXISTS</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="comment">// For a number of error codes (sharing violation, path </span> </pre>
<pre>                     <span class="comment">// not found, etc) we don't know if the problem was with</span> </pre>
<pre>                     <span class="comment">// the source or dest file.  Try reading the source file.</span> </pre>
<pre>                     <span class="keyword">using</span> <span class="delimiter">(</span> <span class="identifier">SafeFileHandle</span> <span class="identifier">handle</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">UnsafeCreateFile</span> <span class="delimiter">(</span> <span class="identifier">fullSourceFileName</span> <span class="operator">,</span>  <span class="identifier">FileStream</span> <span class="operator">.</span> <span class="identifier">GENERIC_READ</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Open</span> <span class="operator">,</span>  <span class="number">0</span> <span class="operator">,</span>  <span class="identifier">IntPtr</span> <span class="operator">.</span> <span class="identifier">Zero</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                         <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">.</span> <span class="identifier">IsInvalid</span> <span class="delimiter">)</span>  </pre>
<pre>                             <span class="identifier">fileName</span>  <span class="operator">=</span>  <span class="identifier">sourceFileName</span> <span class="operator">;</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>                     <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_ACCESS_DENIED</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                         <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">Directory</span> <span class="operator">.</span> <span class="identifier">InternalExists</span> <span class="delimiter">(</span> <span class="identifier">fullDestFileName</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">IOException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Arg_FileIsDirectory_Name"</span>  <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_ACCESS_DENIED</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">fileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>                  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">fullDestFileName</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>         <span class="comment">// Creates a file in a particular path.  If the file exists, it is replaced.</span> </pre>
<pre>         <span class="comment">// The file is opened with ReadWrite accessand cannot be opened by another </span> </pre>
<pre>         <span class="comment">// application until it has been closed.  An IOException is thrown if the </span> </pre>
<pre>         <span class="comment">// directory specified doesn't exist.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// Your application must have Create, Read, and Write permissions to</span> </pre>
<pre>         <span class="comment">// the file.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Create</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">Create</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileStream</span> <span class="operator">.</span> <span class="identifier">DefaultBufferSize</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>          </pre>
<pre>         <span class="comment">// Creates a file in a particular path.  If the file exists, it is replaced.</span> </pre>
<pre>         <span class="comment">// The file is opened with ReadWrite access and cannot be opened by another </span> </pre>
<pre>         <span class="comment">// application until it has been closed.  An IOException is thrown if the </span> </pre>
<pre>         <span class="comment">// directory specified doesn't exist.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// Your application must have Create, Read, and Write permissions to</span> </pre>
<pre>         <span class="comment">// the file.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Create</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">int</span> <span class="identifier">bufferSize</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Create</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">ReadWrite</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="operator">,</span>  <span class="identifier">bufferSize</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Create</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">int</span> <span class="identifier">bufferSize</span> <span class="operator">,</span>  <span class="identifier">FileOptions</span> <span class="identifier">options</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Create</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">ReadWrite</span> <span class="operator">,</span>  </pre>
<pre>                                   <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="operator">,</span>  <span class="identifier">bufferSize</span> <span class="operator">,</span>  <span class="identifier">options</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_MACL</span> </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Create</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">int</span> <span class="identifier">bufferSize</span> <span class="operator">,</span>  <span class="identifier">FileOptions</span> <span class="identifier">options</span> <span class="operator">,</span>  <span class="identifier">FileSecurity</span> <span class="identifier">fileSecurity</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Create</span> <span class="operator">,</span>  <span class="identifier">FileSystemRights</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileSystemRights</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  </pre>
<pre>                                   <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="operator">,</span>  <span class="identifier">bufferSize</span> <span class="operator">,</span>  <span class="identifier">options</span> <span class="operator">,</span>  <span class="identifier">fileSecurity</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>         <span class="comment">// Deletes a file. The file specified by the designated path is deleted.</span> </pre>
<pre>         <span class="comment">// If the file does not exist, Delete succeeds without throwing</span> </pre>
<pre>         <span class="comment">// an exception.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>         <span class="comment">// On NT, Delete will fail for a file that is open for normal I/O</span> </pre>
<pre>         <span class="comment">// or a file that is memory mapped.  </span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>         <span class="comment">// Your application must have Delete permission to the target file.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Delete</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_LEGACYNETCF</span> </pre>
<pre>             <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">CompatibilitySwitches</span> <span class="operator">.</span> <span class="identifier">IsAppEarlierThanWindowsPhone8</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="identifier">callingAssembly</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="operator">.</span> <span class="identifier">GetCallingAssembly</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">callingAssembly</span>   <span class="operator">=</span>  <span class="keyword">null</span>     <span class="identifier">callingAssembly</span> <span class="operator">.</span> <span class="identifier">IsProfileAssembly</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">caller</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Diagnostics</span> <span class="operator">.</span> <span class="identifier">StackFrame</span> <span class="delimiter">(</span> <span class="number">1</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">GetMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">callee</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">MethodBase</span> <span class="operator">.</span> <span class="identifier">GetCurrentMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">MethodAccessException</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Format</span> <span class="delimiter">(</span>  </pre>
<pre>                         <span class="identifier">CultureInfo</span> <span class="operator">.</span> <span class="identifier">CurrentCulture</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Arg_MethodAccessException_WithCaller"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">caller</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">callee</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> <span class="comment">// FEATURE_LEGACYNETCF</span> </pre>
<pre>              </pre>
<pre>             <span class="identifier">InternalDelete</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">UnsafeDelete</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalDelete</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalDelete</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="comment">// For security check, path should be resolved to an absolute path.</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">DeleteFile</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">hr</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">=</span>  <span class="operator">=</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_FILE_NOT_FOUND</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="keyword">return</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">else</span> </pre>
<pre>                     <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Decrypt</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_PAL</span> </pre>
<pre>             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">PlatformNotSupportedException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"PlatformNotSupported_RequiresNT"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">DecryptFile</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_ACCESS_DENIED</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="comment">// Check to see if the file system is not NTFS.  If so,</span> </pre>
<pre>                     <span class="comment">// throw a different exception.</span> </pre>
<pre>                     <span class="identifier">DriveInfo</span> <span class="identifier">di</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">DriveInfo</span> <span class="delimiter">(</span> <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetPathRoot</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Equals</span> <span class="delimiter">(</span> <span class="string">"NTFS"</span>  <span class="operator">,</span>  <span class="identifier">di</span> <span class="operator">.</span> <span class="identifier">DriveFormat</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">NotSupportedException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"NotSupported_EncryptionNeedsNTFS"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Encrypt</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_PAL</span> </pre>
<pre>             <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">PlatformNotSupportedException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"PlatformNotSupported_RequiresNT"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">EncryptFile</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_ACCESS_DENIED</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="comment">// Check to see if the file system is not NTFS.  If so,</span> </pre>
<pre>                     <span class="comment">// throw a different exception.</span> </pre>
<pre>                     <span class="identifier">DriveInfo</span> <span class="identifier">di</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">DriveInfo</span> <span class="delimiter">(</span> <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetPathRoot</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Equals</span> <span class="delimiter">(</span> <span class="string">"NTFS"</span>  <span class="operator">,</span>  <span class="identifier">di</span> <span class="operator">.</span> <span class="identifier">DriveFormat</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">NotSupportedException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"NotSupported_EncryptionNeedsNTFS"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>         <span class="comment">// Tests if a file exists. The result is true if the file</span> </pre>
<pre>         <span class="comment">// given by the specified path exists; otherwise, the result is</span> </pre>
<pre>         <span class="comment">// false.  Note that if path describes a directory,</span> </pre>
<pre>         <span class="comment">// Exists will return true.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// Your application must have Read permission for the target directory.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="identifier">Exists</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_LEGACYNETCF</span> </pre>
<pre>             <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">CompatibilitySwitches</span> <span class="operator">.</span> <span class="identifier">IsAppEarlierThanWindowsPhone8</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="identifier">callingAssembly</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="operator">.</span> <span class="identifier">GetCallingAssembly</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">callingAssembly</span>   <span class="operator">=</span>  <span class="keyword">null</span>     <span class="identifier">callingAssembly</span> <span class="operator">.</span> <span class="identifier">IsProfileAssembly</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">caller</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Diagnostics</span> <span class="operator">.</span> <span class="identifier">StackFrame</span> <span class="delimiter">(</span> <span class="number">1</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">GetMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">callee</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">MethodBase</span> <span class="operator">.</span> <span class="identifier">GetCurrentMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">MethodAccessException</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Format</span> <span class="delimiter">(</span>  </pre>
<pre>                         <span class="identifier">CultureInfo</span> <span class="operator">.</span> <span class="identifier">CurrentCulture</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Arg_MethodAccessException_WithCaller"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">caller</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">callee</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> <span class="comment">// FEATURE_LEGACYNETCF</span> </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalExistsHelper</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="identifier">UnsafeExists</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalExistsHelper</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="identifier">InternalExistsHelper</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">try</span> </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="keyword">return</span> <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="keyword">return</span> <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>                 <span class="identifier">path</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="comment">// After normalizing, check whether path ends in directory separator.</span> </pre>
<pre>                 <span class="comment">// Otherwise, FillAttributeInfo removes it and we may return a false positive.</span> </pre>
<pre>                 <span class="comment">// GetFullPathInternal should never return null</span> </pre>
<pre>                 <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Assert</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="operator">,</span>  <span class="string">"File.Exists: GetFullPathInternal returned null"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span>    <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">IsDirectorySeparator</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">[</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">-</span>  <span class="number">1</span> <span class="delimiter">]</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">return</span> <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Empty</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>                 <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>                 <span class="keyword">return</span> <span class="identifier">InternalExists</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">catch</span>  <span class="delimiter">(</span> <span class="identifier">ArgumentException</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>   <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">catch</span>  <span class="delimiter">(</span> <span class="identifier">NotSupportedException</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>   <span class="delimiter">}</span>  <span class="comment">// Security can throw this on ":"</span> </pre>
<pre>             <span class="keyword">catch</span>  <span class="delimiter">(</span> <span class="identifier">SecurityException</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>   <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">catch</span>  <span class="delimiter">(</span> <span class="identifier">IOException</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>   <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">catch</span>  <span class="delimiter">(</span> <span class="identifier">UnauthorizedAccessException</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>   <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">bool</span> <span class="identifier">InternalExists</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>      <span class="delimiter">(</span> <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">fileAttributes</span>   <span class="operator">=</span>   <span class="operator">-</span> <span class="number">1</span> <span class="delimiter">)</span>   </pre>
<pre>                         <span class="delimiter">(</span>  <span class="delimiter">(</span> <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">fileAttributes</span>    <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_ATTRIBUTE_DIRECTORY</span> <span class="delimiter">)</span>   <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Open</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="identifier">mode</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">Open</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">mode</span> <span class="operator">,</span>   <span class="delimiter">(</span> <span class="identifier">mode</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Append</span>   <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span>  <span class="operator">:</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">ReadWrite</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Open</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="identifier">mode</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="identifier">access</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">Open</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span> <span class="identifier">mode</span> <span class="operator">,</span>  <span class="identifier">access</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">Open</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="identifier">mode</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="identifier">access</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="identifier">share</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">mode</span> <span class="operator">,</span>  <span class="identifier">access</span> <span class="operator">,</span>  <span class="identifier">share</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetCreationTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">creationTime</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">creationTime</span> <span class="operator">.</span> <span class="identifier">ToUniversalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">creationTimeUtc</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SafeFileHandle</span> <span class="identifier">handle</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">using</span> <span class="delimiter">(</span> <span class="identifier">OpenFile</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="keyword">out</span> <span class="identifier">handle</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="identifier">fileTime</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="delimiter">(</span> <span class="identifier">creationTimeUtc</span> <span class="operator">.</span> <span class="identifier">ToFileTimeUtc</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetFileTime</span> <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">,</span>   <span class="identifier">fileTime</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                      <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetCreationTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">ToLocalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  <span class="comment">// this API isn't exposed in Silverlight</span> </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">InternalGetCreationTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">dataInitialised</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">DateTime</span> <span class="operator">.</span> <span class="identifier">FromFileTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">ftCreationTime</span> <span class="operator">.</span> <span class="identifier">ToTicks</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetLastAccessTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">lastAccessTime</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">lastAccessTime</span> <span class="operator">.</span> <span class="identifier">ToUniversalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">lastAccessTimeUtc</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SafeFileHandle</span> <span class="identifier">handle</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">using</span> <span class="delimiter">(</span> <span class="identifier">OpenFile</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="keyword">out</span> <span class="identifier">handle</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="identifier">fileTime</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="delimiter">(</span> <span class="identifier">lastAccessTimeUtc</span> <span class="operator">.</span> <span class="identifier">ToFileTimeUtc</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetFileTime</span> <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="operator">,</span>   <span class="identifier">fileTime</span> <span class="operator">,</span>   <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                      <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetLastAccessTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">ToLocalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  <span class="comment">// this API isn't exposed in Silverlight</span> </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">InternalGetLastAccessTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>         </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">dataInitialised</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">DateTime</span> <span class="operator">.</span> <span class="identifier">FromFileTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">ftLastAccessTime</span> <span class="operator">.</span> <span class="identifier">ToTicks</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetLastWriteTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">lastWriteTime</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">lastWriteTime</span> <span class="operator">.</span> <span class="identifier">ToUniversalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">unsafe</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">DateTime</span> <span class="identifier">lastWriteTimeUtc</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">SafeFileHandle</span> <span class="identifier">handle</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">using</span> <span class="delimiter">(</span> <span class="identifier">OpenFile</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="keyword">out</span> <span class="identifier">handle</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="identifier">fileTime</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FILE_TIME</span> <span class="delimiter">(</span> <span class="identifier">lastWriteTimeUtc</span> <span class="operator">.</span> <span class="identifier">ToFileTimeUtc</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetFileTime</span> <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="operator">,</span>  <span class="keyword">null</span> <span class="operator">,</span>   <span class="identifier">fileTime</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                      <span class="keyword">int</span> <span class="identifier">errorCode</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">errorCode</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetLastWriteTime</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">ToLocalTime</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">GetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalGetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  <span class="comment">// this API isn't exposed in Silverlight</span> </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">DateTime</span> <span class="identifier">InternalGetLastWriteTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">dataInitialised</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">DateTime</span> <span class="operator">.</span> <span class="identifier">FromFileTimeUtc</span> <span class="delimiter">(</span> <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">ftLastWriteTime</span> <span class="operator">.</span> <span class="identifier">ToTicks</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileAttributes</span> <span class="identifier">GetAttributes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="identifier">FileSecurityState</span> <span class="identifier">state</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">state</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">dataInitialised</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span>  <span class="delimiter">(</span> <span class="identifier">FileAttributes</span> <span class="delimiter">)</span>  <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">fileAttributes</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>         <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   </pre>
<pre>         <span class="keyword">#else</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">#endif</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetAttributes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileAttributes</span> <span class="identifier">fileAttributes</span> <span class="delimiter">)</span>   </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#if</span>  <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetFileAttributes</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="operator">,</span>   <span class="delimiter">(</span> <span class="keyword">int</span> <span class="delimiter">)</span>  <span class="identifier">fileAttributes</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">hr</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">=</span>  <span class="operator">=</span> <span class="identifier">ERROR_INVALID_PARAMETER</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Arg_InvalidFileAttrs"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">,</span>  <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_MACL</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileSecurity</span> <span class="identifier">GetAccessControl</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">GetAccessControl</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">AccessControlSections</span> <span class="operator">.</span> <span class="identifier">Access</span>   <span class="identifier">AccessControlSections</span> <span class="operator">.</span> <span class="identifier">Owner</span>   <span class="identifier">AccessControlSections</span> <span class="operator">.</span> <span class="identifier">Group</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileSecurity</span> <span class="identifier">GetAccessControl</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">AccessControlSections</span> <span class="identifier">includeSections</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="comment">// Appropriate security check should be done for us by FileSecurity.</span> </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileSecurity</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">includeSections</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">SetAccessControl</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileSecurity</span> <span class="identifier">fileSecurity</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">fileSecurity</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"fileSecurity"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="comment">// Appropriate security check should be done for us by FileSecurity.</span> </pre>
<pre>             <span class="identifier">fileSecurity</span> <span class="operator">.</span> <span class="identifier">Persist</span> <span class="delimiter">(</span> <span class="identifier">fullPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_LEGACYNETCF</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre> <span class="keyword">#endif</span> <span class="comment">// FEATURE_LEGACYNETCF</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">OpenRead</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_LEGACYNETCF</span> </pre>
<pre>             <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">CompatibilitySwitches</span> <span class="operator">.</span> <span class="identifier">IsAppEarlierThanWindowsPhone8</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="identifier">callingAssembly</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">Assembly</span> <span class="operator">.</span> <span class="identifier">GetCallingAssembly</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span> <span class="delimiter">(</span> <span class="identifier">callingAssembly</span>   <span class="operator">=</span>  <span class="keyword">null</span>     <span class="identifier">callingAssembly</span> <span class="operator">.</span> <span class="identifier">IsProfileAssembly</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">caller</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Diagnostics</span> <span class="operator">.</span> <span class="identifier">StackFrame</span> <span class="delimiter">(</span> <span class="number">1</span> <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">GetMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">string</span> <span class="identifier">callee</span>  <span class="operator">=</span>  <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Reflection</span> <span class="operator">.</span> <span class="identifier">MethodBase</span> <span class="operator">.</span> <span class="identifier">GetCurrentMethod</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">.</span> <span class="identifier">FullName</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">MethodAccessException</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="operator">.</span> <span class="identifier">Format</span> <span class="delimiter">(</span>  </pre>
<pre>                         <span class="identifier">CultureInfo</span> <span class="operator">.</span> <span class="identifier">CurrentCulture</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Arg_MethodAccessException_WithCaller"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">caller</span> <span class="operator">,</span>  </pre>
<pre>                         <span class="identifier">callee</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> <span class="comment">// FEATURE_LEGACYNETCF</span> </pre>
<pre>                                                            <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Open</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">OpenWrite</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">OpenOrCreate</span> <span class="operator">,</span>   </pre>
<pre>                                   <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="identifier">ReadAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="operator">.</span> <span class="identifier">UTF8</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="identifier">ReadAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="identifier">UnsafeReadAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="operator">.</span> <span class="identifier">UTF8</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="identifier">InternalReadAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">encoding</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">StreamReader</span> <span class="identifier">sr</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">StreamReader</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="operator">,</span>  <span class="identifier">StreamReader</span> <span class="operator">.</span> <span class="identifier">DefaultBufferSize</span> <span class="operator">,</span>  <span class="identifier">checkHost</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">return</span> <span class="identifier">sr</span> <span class="operator">.</span> <span class="identifier">ReadToEnd</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>          </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">UnsafeWriteAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalWriteAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">encoding</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">StreamWriter</span> <span class="identifier">sw</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">DefaultBufferSize</span> <span class="operator">,</span>  <span class="identifier">checkHost</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">sw</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="delimiter">(</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>   </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">ReadAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllBytes</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">UnsafeReadAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllBytes</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">InternalReadAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">bytes</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">using</span> <span class="delimiter">(</span> <span class="identifier">FileStream</span> <span class="identifier">fs</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Open</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>   </pre>
<pre>                 <span class="identifier">FileStream</span> <span class="operator">.</span> <span class="identifier">DefaultBufferSize</span> <span class="operator">,</span>  <span class="identifier">FileOptions</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="operator">,</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFileName</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">checkHost</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="comment">// Do a blocking read</span> </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">index</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">long</span> <span class="identifier">fileLength</span>  <span class="operator">=</span>  <span class="identifier">fs</span> <span class="operator">.</span> <span class="identifier">Length</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">fileLength</span>  <span class="operator">></span>  <span class="identifier">Int32</span> <span class="operator">.</span> <span class="identifier">MaxValue</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">IOException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"IO.IO_FileTooLong2GB"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">count</span>  <span class="operator">=</span>   <span class="delimiter">(</span> <span class="keyword">int</span> <span class="delimiter">)</span>  <span class="identifier">fileLength</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">bytes</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="keyword">byte</span> <span class="delimiter">[</span> <span class="identifier">count</span> <span class="delimiter">]</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">while</span> <span class="delimiter">(</span> <span class="identifier">count</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">int</span> <span class="identifier">n</span>  <span class="operator">=</span>  <span class="identifier">fs</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="delimiter">(</span> <span class="identifier">bytes</span> <span class="operator">,</span>  <span class="identifier">index</span> <span class="operator">,</span>  <span class="identifier">count</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">n</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                         <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">EndOfFile</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">index</span>  <span class="operator">+</span>  <span class="operator">=</span>  <span class="identifier">n</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">count</span>  <span class="operator">-</span>  <span class="operator">=</span>  <span class="identifier">n</span> <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">bytes</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">bytes</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_Path"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">bytes</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"bytes"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllBytes</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">bytes</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">UnsafeWriteAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">bytes</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_Path"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">bytes</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"bytes"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllBytes</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">bytes</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalWriteAllBytes</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">byte</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">bytes</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">bytes</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">FileStream</span> <span class="identifier">fs</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Create</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  </pre>
<pre>                     <span class="identifier">FileStream</span> <span class="operator">.</span> <span class="identifier">DefaultBufferSize</span> <span class="operator">,</span>  <span class="identifier">FileOptions</span> <span class="operator">.</span> <span class="identifier">None</span> <span class="operator">,</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFileName</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">checkHost</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">fs</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="delimiter">(</span> <span class="identifier">bytes</span> <span class="operator">,</span>  <span class="number">0</span> <span class="operator">,</span>  <span class="identifier">bytes</span> <span class="operator">.</span> <span class="identifier">Length</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">ReadAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllLines</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="operator">.</span> <span class="identifier">UTF8</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">ReadAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">InternalReadAllLines</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">InternalReadAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">encoding</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>   <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">line</span> <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">List</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">lines</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">List</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">StreamReader</span> <span class="identifier">sr</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">StreamReader</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">while</span>  <span class="delimiter">(</span>  <span class="delimiter">(</span> <span class="identifier">line</span>  <span class="operator">=</span>  <span class="identifier">sr</span> <span class="operator">.</span> <span class="identifier">ReadLine</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>    <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="identifier">lines</span> <span class="operator">.</span> <span class="identifier">Add</span> <span class="delimiter">(</span> <span class="identifier">line</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">lines</span> <span class="operator">.</span> <span class="identifier">ToArray</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">ReadLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">ReadLinesIterator</span> <span class="operator">.</span> <span class="identifier">CreateIterator</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="operator">.</span> <span class="identifier">UTF8</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">ReadLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">ReadLinesIterator</span> <span class="operator">.</span> <span class="identifier">CreateIterator</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">WriteAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="identifier">TextWriter</span> <span class="identifier">writer</span> <span class="operator">,</span>  <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">writer</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">contents</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">writer</span> <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="keyword">foreach</span>  <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">line</span> <span class="keyword">in</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>                  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">writer</span> <span class="operator">.</span> <span class="identifier">WriteLine</span> <span class="delimiter">(</span> <span class="identifier">line</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">AppendAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalAppendAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">AppendAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalAppendAllText</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalAppendAllText</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">encoding</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">></span>  <span class="number">0</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">using</span>  <span class="delimiter">(</span> <span class="identifier">StreamWriter</span> <span class="identifier">sw</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">sw</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="delimiter">(</span> <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">AppendAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="operator">,</span>  <span class="identifier">StreamWriter</span> <span class="operator">.</span> <span class="identifier">UTF8NoBOM</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">AppendAllLines</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">IEnumerable</span> <span class="operator"><</span> <span class="identifier">String</span> <span class="operator">></span>  <span class="identifier">contents</span> <span class="operator">,</span>  <span class="identifier">Encoding</span> <span class="identifier">encoding</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"path"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">contents</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"contents"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">encoding</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"encoding"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyPath"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalWriteAllLines</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="identifier">StreamWriter</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="operator">,</span>  <span class="identifier">encoding</span> <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="identifier">contents</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>         <span class="comment">// Moves a specified file to a new location and potentially a new file name.</span> </pre>
<pre>         <span class="comment">// This method does work across volumes.</span> </pre>
<pre>         <span class="comment">//</span> </pre>
<pre>         <span class="comment">// The caller must have certain FileIOPermissions.  The caller must</span> </pre>
<pre>         <span class="comment">// have Read and Write permission to </span> </pre>
<pre>         <span class="comment">// sourceFileName and Write </span> </pre>
<pre>         <span class="comment">// permissions to destFileName.</span> </pre>
<pre>         <span class="comment">// </span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Move</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">InternalMove</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">UnsafeMove</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">InternalMove</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalMove</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destFileName"</span>  <span class="operator">,</span>  <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"ArgumentNull_FileName"</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="operator">.</span> <span class="identifier">Length</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentException</span> <span class="delimiter">(</span> <span class="identifier">Environment</span> <span class="operator">.</span> <span class="identifier">GetResourceString</span> <span class="delimiter">(</span> <span class="string">"Argument_EmptyFileName"</span>  <span class="delimiter">)</span>  <span class="operator">,</span>  <span class="string">"destFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullSourceFileName</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullDestFileName</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">destFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">checkHost</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">sourceState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span>   <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">fullSourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">FileSecurityState</span> <span class="identifier">destState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">destFileName</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">sourceState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">destState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span>   <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span> <span class="operator">,</span>  <span class="identifier">fullSourceFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">QuickDemand</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">InternalExists</span> <span class="delimiter">(</span> <span class="identifier">fullSourceFileName</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_FILE_NOT_FOUND</span> <span class="operator">,</span>  <span class="identifier">fullSourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">MoveFile</span> <span class="delimiter">(</span> <span class="identifier">fullSourceFileName</span> <span class="operator">,</span>  <span class="identifier">fullDestFileName</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Replace</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationBackupFileName</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destinationFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destinationFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalReplace</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">destinationBackupFileName</span> <span class="operator">,</span>  <span class="keyword">false</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">Replace</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationBackupFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">ignoreMetadataErrors</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"sourceFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destinationFileName</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="keyword">throw</span> <span class="keyword">new</span> <span class="identifier">ArgumentNullException</span> <span class="delimiter">(</span> <span class="string">"destinationFileName"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">EndContractBlock</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="identifier">InternalReplace</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">destinationBackupFileName</span> <span class="operator">,</span>  <span class="identifier">ignoreMetadataErrors</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecuritySafeCritical</span> <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="identifier">InternalReplace</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">String</span> <span class="identifier">destinationBackupFileName</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">ignoreMetadataErrors</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Requires</span> <span class="delimiter">(</span> <span class="identifier">destinationFileName</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="comment">// Write permission to all three files, read permission to source </span> </pre>
<pre>             <span class="comment">// and dest.</span> </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullSrcPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">sourceFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullDestPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">destinationFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">String</span> <span class="identifier">fullBackupPath</span>  <span class="operator">=</span>  <span class="keyword">null</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">destinationBackupFileName</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">fullBackupPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">destinationBackupFileName</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CORECLR</span> </pre>
<pre>             <span class="identifier">FileSecurityState</span> <span class="identifier">sourceState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">sourceFileName</span> <span class="operator">,</span>  <span class="identifier">fullSrcPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileSecurityState</span> <span class="identifier">destState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">destinationFileName</span> <span class="operator">,</span>  <span class="identifier">fullDestPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">FileSecurityState</span> <span class="identifier">backupState</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileSecurityState</span> <span class="delimiter">(</span> <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileSecurityStateAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">destinationBackupFileName</span> <span class="operator">,</span>  <span class="identifier">fullBackupPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">sourceState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">destState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">backupState</span> <span class="operator">.</span> <span class="identifier">EnsureState</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre> <span class="keyword">#else</span> </pre>
<pre> <span class="keyword">#if</span> <span class="identifier">FEATURE_CAS_POLICY</span> </pre>
<pre>             <span class="comment">// All demands in full trust domains are no-ops, just do additional checks</span> </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">CodeAccessSecurityEngine</span> <span class="operator">.</span> <span class="identifier">QuickCheckForAllDemands</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">EmulateFileIOPermissionChecks</span> <span class="delimiter">(</span> <span class="identifier">fullSrcPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">EmulateFileIOPermissionChecks</span> <span class="delimiter">(</span> <span class="identifier">fullDestPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">fullBackupPath</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="identifier">FileIOPermission</span> <span class="operator">.</span> <span class="identifier">EmulateFileIOPermissionChecks</span> <span class="delimiter">(</span> <span class="identifier">fullBackupPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">else</span> </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">FileIOPermission</span> <span class="identifier">perm</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileIOPermission</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Read</span>   <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="keyword">new</span> <span class="identifier">String</span> <span class="delimiter">[</span>  <span class="delimiter">]</span>   <span class="delimiter">{</span>  <span class="identifier">fullSrcPath</span> <span class="operator">,</span>  <span class="identifier">fullDestPath</span>  <span class="delimiter">}</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">fullBackupPath</span>   <span class="operator">=</span>  <span class="keyword">null</span> <span class="delimiter">)</span>  </pre>
<pre>                     <span class="identifier">perm</span> <span class="operator">.</span> <span class="identifier">AddPathList</span> <span class="delimiter">(</span> <span class="identifier">FileIOPermissionAccess</span> <span class="operator">.</span> <span class="identifier">Write</span> <span class="operator">,</span>  <span class="identifier">fullBackupPath</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">perm</span> <span class="operator">.</span> <span class="identifier">Demand</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre> <span class="keyword">#endif</span> </pre>
<pre>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">flags</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">REPLACEFILE_WRITE_THROUGH</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">ignoreMetadataErrors</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">flags</span>   <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">REPLACEFILE_IGNORE_MERGE_ERRORS</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">bool</span> <span class="identifier">r</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ReplaceFile</span> <span class="delimiter">(</span> <span class="identifier">fullDestPath</span> <span class="operator">,</span>  <span class="identifier">fullSrcPath</span> <span class="operator">,</span>  <span class="identifier">fullBackupPath</span> <span class="operator">,</span>  <span class="identifier">flags</span> <span class="operator">,</span>  <span class="identifier">IntPtr</span> <span class="operator">.</span> <span class="identifier">Zero</span> <span class="operator">,</span>  <span class="identifier">IntPtr</span> <span class="operator">.</span> <span class="identifier">Zero</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">r</span> <span class="delimiter">)</span>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>         <span class="comment">// Returns 0 on success, otherwise a Win32 error code.  Note that</span> </pre>
<pre>         <span class="comment">// classes should use -1 as the uninitialized state for dataInitialized.</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">internal</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FILE_ATTRIBUTE_DATA</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">tryagain</span> <span class="operator">,</span>  <span class="keyword">bool</span> <span class="identifier">returnErrorOnNotFound</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="keyword">int</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="operator">;</span>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">tryagain</span> <span class="delimiter">)</span>  <span class="comment">// someone has a handle to the file open, or other error</span> </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>                 <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FIND_DATA</span> <span class="identifier">findData</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">findData</span>  <span class="operator">=</span>   <span class="keyword">new</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">WIN32_FIND_DATA</span>  <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>   </pre>
<pre>                  </pre>
<pre>                 <span class="comment">// Remove trialing slash since this can cause grief to FindFirstFile. You will get an invalid argument error</span> </pre>
<pre>                 <span class="identifier">String</span> <span class="identifier">tempPath</span>  <span class="operator">=</span>  <span class="identifier">path</span> <span class="operator">.</span> <span class="identifier">TrimEnd</span> <span class="delimiter">(</span> <span class="keyword">new</span> <span class="keyword">char</span>  <span class="delimiter">[</span>  <span class="delimiter">]</span>   <span class="delimiter">{</span> <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">DirectorySeparatorChar</span> <span class="operator">,</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">AltDirectorySeparatorChar</span> <span class="delimiter">}</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>                 <span class="comment">// For floppy drives, normally the OS will pop up a dialog saying</span> </pre>
<pre>                 <span class="comment">// there is no disk in drive A:, please insert one.  We don't want that.</span> </pre>
<pre>                 <span class="comment">// SetErrorMode will let us disable this, but we should set the error</span> </pre>
<pre>                 <span class="comment">// mode back, since this may have wide-ranging effects.</span> </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">oldMode</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetErrorMode</span> <span class="delimiter">(</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SEM_FAILCRITICALERRORS</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">try</span>  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="keyword">bool</span> <span class="identifier">error</span>  <span class="operator">=</span>  <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>                     <span class="identifier">SafeFindHandle</span> <span class="identifier">handle</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">FindFirstFile</span> <span class="delimiter">(</span> <span class="identifier">tempPath</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">findData</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">try</span>  <span class="delimiter">{</span>  </pre>
<pre>                         <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">.</span> <span class="identifier">IsInvalid</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                             <span class="identifier">error</span>  <span class="operator">=</span>  <span class="keyword">true</span> <span class="operator">;</span>  </pre>
<pre>                             <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                              </pre>
<pre>                             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_FILE_NOT_FOUND</span>    </pre>
<pre>                                 <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_PATH_NOT_FOUND</span>    </pre>
<pre>                                 <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_NOT_READY</span> <span class="delimiter">)</span>   <span class="comment">// floppy device not ready</span> </pre>
<pre>                              <span class="delimiter">{</span>  </pre>
<pre>                                 <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">returnErrorOnNotFound</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                                     <span class="comment">// Return default value for backward compatibility</span> </pre>
<pre>                                     <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="operator">;</span>  </pre>
<pre>                                     <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">fileAttributes</span>  <span class="operator">=</span>   <span class="operator">-</span> <span class="number">1</span> <span class="operator">;</span>  </pre>
<pre>                                  <span class="delimiter">}</span>  </pre>
<pre>                              <span class="delimiter">}</span>  </pre>
<pre>                             <span class="keyword">return</span> <span class="identifier">dataInitialised</span> <span class="operator">;</span>  </pre>
<pre>                          <span class="delimiter">}</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>                     <span class="keyword">finally</span>  <span class="delimiter">{</span>  </pre>
<pre>                         <span class="comment">// Close the Win32 handle</span> </pre>
<pre>                         <span class="keyword">try</span>  <span class="delimiter">{</span>  </pre>
<pre>                             <span class="identifier">handle</span> <span class="operator">.</span> <span class="identifier">Close</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                          <span class="delimiter">}</span>  </pre>
<pre>                         <span class="keyword">catch</span>  <span class="delimiter">{</span>  </pre>
<pre>                             <span class="comment">// if we're already returning an error, don't throw another one. </span> </pre>
<pre>                             <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">error</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                                 <span class="identifier">Contract</span> <span class="operator">.</span> <span class="identifier">Assert</span> <span class="delimiter">(</span> <span class="keyword">false</span> <span class="operator">,</span>  <span class="string">"File::FillAttributeInfo - FindClose failed!"</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                              <span class="delimiter">}</span>  </pre>
<pre>                          <span class="delimiter">}</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>                 <span class="keyword">finally</span>  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetErrorMode</span> <span class="delimiter">(</span> <span class="identifier">oldMode</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>                 <span class="comment">// Copy the information to data</span> </pre>
<pre>                 <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">PopulateFrom</span> <span class="delimiter">(</span> <span class="keyword">ref</span> <span class="identifier">findData</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">else</span> </pre>
<pre>              <span class="delimiter">{</span>  </pre>
<pre>  </pre>
<pre>                  <span class="comment">// For floppy drives, normally the OS will pop up a dialog saying</span> </pre>
<pre>                 <span class="comment">// there is no disk in drive A:, please insert one.  We don't want that.</span> </pre>
<pre>                 <span class="comment">// SetErrorMode will let us disable this, but we should set the error</span> </pre>
<pre>                 <span class="comment">// mode back, since this may have wide-ranging effects.</span> </pre>
<pre>                 <span class="keyword">bool</span> <span class="identifier">success</span>  <span class="operator">=</span>  <span class="keyword">false</span> <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">oldMode</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetErrorMode</span> <span class="delimiter">(</span> <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SEM_FAILCRITICALERRORS</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">try</span>  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">success</span>  <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">GetFileAttributesEx</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">GetFileExInfoStandard</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>                 <span class="keyword">finally</span>  <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">SetErrorMode</span> <span class="delimiter">(</span> <span class="identifier">oldMode</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">success</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                     <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                     <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_FILE_NOT_FOUND</span>    </pre>
<pre>                         <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_PATH_NOT_FOUND</span>    </pre>
<pre>                         <span class="identifier">dataInitialised</span>   <span class="operator">=</span>  <span class="identifier">Win32Native</span> <span class="operator">.</span> <span class="identifier">ERROR_NOT_READY</span> <span class="delimiter">)</span>   <span class="comment">// floppy device not ready</span> </pre>
<pre>                      <span class="delimiter">{</span>  </pre>
<pre>                      <span class="comment">// In case someone latched onto the file. Take the perf hit only for failure</span> </pre>
<pre>                         <span class="keyword">return</span> <span class="identifier">FillAttributeInfo</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="keyword">ref</span> <span class="identifier">data</span> <span class="operator">,</span>  <span class="keyword">true</span> <span class="operator">,</span>  <span class="identifier">returnErrorOnNotFound</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>                     <span class="keyword">else</span>  <span class="delimiter">{</span>  </pre>
<pre>                         <span class="keyword">if</span>  <span class="delimiter">(</span>  <span class="identifier">returnErrorOnNotFound</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                             <span class="comment">// Return default value for backward compbatibility</span> </pre>
<pre>                             <span class="identifier">dataInitialised</span>  <span class="operator">=</span>  <span class="number">0</span> <span class="operator">;</span>  </pre>
<pre>                             <span class="identifier">data</span> <span class="operator">.</span> <span class="identifier">fileAttributes</span>  <span class="operator">=</span>   <span class="operator">-</span> <span class="number">1</span> <span class="operator">;</span>  </pre>
<pre>                          <span class="delimiter">}</span>  </pre>
<pre>                      <span class="delimiter">}</span>  </pre>
<pre>                  <span class="delimiter">}</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">dataInitialised</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">System</span> <span class="operator">.</span> <span class="identifier">Security</span> <span class="operator">.</span> <span class="identifier">SecurityCritical</span> <span class="delimiter">]</span>   <span class="comment">// auto-generated</span> </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceExposure</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>          <span class="delimiter">[</span> <span class="identifier">ResourceConsumption</span> <span class="delimiter">(</span> <span class="identifier">ResourceScope</span> <span class="operator">.</span> <span class="identifier">Machine</span> <span class="delimiter">)</span>  <span class="delimiter">]</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">static</span> <span class="identifier">FileStream</span> <span class="identifier">OpenFile</span> <span class="delimiter">(</span> <span class="identifier">String</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileAccess</span> <span class="identifier">access</span> <span class="operator">,</span>  <span class="keyword">out</span> <span class="identifier">SafeFileHandle</span> <span class="identifier">handle</span> <span class="delimiter">)</span>  </pre>
<pre>          <span class="delimiter">{</span>  </pre>
<pre>             <span class="identifier">FileStream</span> <span class="identifier">fs</span>  <span class="operator">=</span>  <span class="keyword">new</span> <span class="identifier">FileStream</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="operator">,</span>  <span class="identifier">FileMode</span> <span class="operator">.</span> <span class="identifier">Open</span> <span class="operator">,</span>  <span class="identifier">access</span> <span class="operator">,</span>  <span class="identifier">FileShare</span> <span class="operator">.</span> <span class="identifier">ReadWrite</span> <span class="operator">,</span>  <span class="number">1</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>             <span class="identifier">handle</span>  <span class="operator">=</span>  <span class="identifier">fs</span> <span class="operator">.</span> <span class="identifier">SafeFileHandle</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>             <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">handle</span> <span class="operator">.</span> <span class="identifier">IsInvalid</span> <span class="delimiter">)</span>   <span class="delimiter">{</span>  </pre>
<pre>                 <span class="comment">// Return a meaningful error, using the RELATIVE path to</span> </pre>
<pre>                 <span class="comment">// the file to avoid returning extra information to the caller.</span> </pre>
<pre>              </pre>
<pre>                 <span class="comment">// NT5 oddity - when trying to open "C:\" as a FileStream,</span> </pre>
<pre>                 <span class="comment">// we usually get ERROR_PATH_NOT_FOUND from the OS.  We should</span> </pre>
<pre>                 <span class="comment">// probably be consistent w/ every other directory.</span> </pre>
<pre>                 <span class="keyword">int</span> <span class="identifier">hr</span>  <span class="operator">=</span>  <span class="identifier">Marshal</span> <span class="operator">.</span> <span class="identifier">GetLastWin32Error</span> <span class="delimiter">(</span>  <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="identifier">String</span> <span class="identifier">FullPath</span>  <span class="operator">=</span>  <span class="identifier">Path</span> <span class="operator">.</span> <span class="identifier">GetFullPathInternal</span> <span class="delimiter">(</span> <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>                 <span class="keyword">if</span>  <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">=</span>  <span class="operator">=</span> <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">ERROR_PATH_NOT_FOUND</span>    <span class="identifier">FullPath</span> <span class="operator">.</span> <span class="identifier">Equals</span> <span class="delimiter">(</span> <span class="identifier">Directory</span> <span class="operator">.</span> <span class="identifier">GetDirectoryRoot</span> <span class="delimiter">(</span> <span class="identifier">FullPath</span> <span class="delimiter">)</span>  <span class="delimiter">)</span>  <span class="delimiter">)</span>  </pre>
<pre>                     <span class="identifier">hr</span>  <span class="operator">=</span>  <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">ERROR_ACCESS_DENIED</span> <span class="operator">;</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>                 <span class="identifier">__Error</span> <span class="operator">.</span> <span class="identifier">WinIOError</span> <span class="delimiter">(</span> <span class="identifier">hr</span> <span class="operator">,</span>  <span class="identifier">path</span> <span class="delimiter">)</span>  <span class="operator">;</span>  </pre>
<pre>              <span class="delimiter">}</span>  </pre>
<pre>             <span class="keyword">return</span> <span class="identifier">fs</span> <span class="operator">;</span>  </pre>
<pre>          <span class="delimiter">}</span>  </pre>
<pre>  </pre>
<pre>  </pre>
<pre>          <span class="comment">// Defined in WinError.h</span> </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">int</span> <span class="identifier">ERROR_INVALID_PARAMETER</span>  <span class="operator">=</span>  <span class="number">87</span> <span class="operator">;</span>  </pre>
<pre>         <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">int</span> <span class="identifier">ERROR_ACCESS_DENIED</span>  <span class="operator">=</span>  <span class="number">0x5</span> <span class="operator">;</span>       </pre>
<pre>      <span class="delimiter">}</span>  </pre>
<pre>  <span class="delimiter">}</span>  </pre>
</body></html>